; Gianluca Capezzuto Sardinha- 11876933

			ORG	0
			SJMP	PROG

			ORG	1Bh
			SJMP	INT_1


PROG:			MOV	A,  #00h
			MOV	R2, #00h 
			MOV	P2, #0FFh
			CLR	F0
INIC:			MOV	P1, #0FFh
			MOV	R0, #7Fh
LOOP:			ACALL	VARRE
			MOV	A, P1
			ORL	A, #0F0h
			CJNE	A, #0FFh, TECLA
			SJMP	LOOP
TECLA:			MOV	R1, P1
			MOV	A, P1
			ACALL	CHECK
			CPL	A 
			MOV	P2, A
			SJMP	INIC

VARRE:			MOV	A, R0
			MOV	P1, A
			RR	A
			JNB	ACC.3, FIM
			MOV	R0, A
			RET
FIM:			MOV	R0, #7Fh
			RET

INT_1:			SETB	F0
			RETI

CHECK:			CJNE	R2, #04h, C3
			SJMP	TGRADE
C3:			CJNE	R2, #03h, CB 
			SJMP	T3
CB:			CJNE	R2, #02h, CA 
			SJMP	TB
CA:			CJNE	R2, #01h, T7 
			SJMP	TA


T7:			CJNE	A, #11101011b, ERRADA 
			INC	R2
			RET
TA:			CJNE	A, #01111110b, ERRADA
			INC	R2
			RET
TB:			CJNE	A, #01111101b, ERRADA 
			INC	R2
			RET
T3:			CJNE	A, #10111110b, ERRADA 
			INC	R2
			RET
TGRADE:			CJNE	A, #10110111b, ERRO_TOTAL
			INC	R2
			ACALL	LED
			RET

ERRADA:			RET
ERRO_TOTAL:		MOV	R2, #00h ; resetar a contagem
			SJMP	ERRO_TOTAL_LED
			RET

ERRO_TOTAL_LED:		MOV	P2, #00h
			ACALL	DELAY
			JB	F0, PROG
			SJMP	ERRO_TOTAL_LED

LED:			MOV	P2, #11111110B 
			ACALL 	DELAY
			MOV	P2, #11111101B
			ACALL 	DELAY
			MOV	P2, #11111011B
			ACALL 	DELAY
			MOV	P2, #11110111B
			ACALL 	DELAY
			MOV	P2, #11101111B
			ACALL 	DELAY
			MOV	P2, #11011111B
			ACALL 	DELAY
			MOV	P2, #10111111B
			ACALL 	DELAY
			MOV	P2, #01111111B
			ACALL 	DELAY
			RET


DELAY:			MOV	R4, #018h
			NOP
			DJNZ	R4, $

			END 
